<!doctype html><html lang=zh dir=auto><head><meta name=generator content="Hugo 0.110.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>fissssssh</title><meta name=description content><meta name=author content><link rel=canonical href=https://blog.fissssssh.com/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://blog.fissssssh.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.fissssssh.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.fissssssh.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.fissssssh.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.fissssssh.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://blog.fissssssh.com/index.xml><link rel=alternate type=application/json href=https://blog.fissssssh.com/index.json><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="fissssssh"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://blog.fissssssh.com/"><meta name=twitter:card content="summary"><meta name=twitter:title content="fissssssh"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"fissssssh","url":"https://blog.fissssssh.com/","description":"","thumbnailUrl":"https://blog.fissssssh.com/favicon.ico","sameAs":["https://github.com/fissssssh"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.fissssssh.com/ accesskey=h title="fissssssh (Alt + H)">fissssssh</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.fissssssh.com/posts/ title=文章><span>文章</span></a></li><li><a href=https://blog.fissssssh.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.fissssssh.com/tags/ title=标签><span>标签</span></a></li><li><a href=https://blog.fissssssh.com/links/ title=友链><span>友链</span></a></li><li><a href=https://blog.fissssssh.com/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class="first-entry home-info"><header class=entry-header><h1>Welcome</h1></header><div class=entry-content>I&rsquo;m a Chinese software engineer, here is all my experience.</div><footer class=entry-footer><div class=social-icons><a href=https://github.com/fissssssh target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></footer></article><article class=post-entry><header class=entry-header><h2>生成 HTTP 查询字符串</h2></header><div class=entry-content><p>什么是 HTTP 查询字符串 例如此 URL：https://example.com:80/query?key1=value2&key2=value2
对其拆解我们可以得到以下部分：
https：协议 :// example.com：域名 :80：端口 /query：路径 ?key1=value2&key2=value2：参数（也称作查询字符串） 如何生成 HTTP 查询字符串 暴力拼接 略
System.Web.HttpUtility var query = HttpUtility.ParseQueryString(string.Empty); query["a+b"] = "a%b"; query["b"] = "2+1"; var queryString = query.ToString(); // a+b=a%25b&b=2%2b1 HttpUtility.ParseQueryString(string.Empty) 会返回一个空的NameValueCollection，你只需要往里面填充参数然后调用ToString()即可生成查询字符串
您不能使用 new NameValueCollection() 来达到同样的效果，因为 HttpUtility.ParseQueryString(string) 返回的实际是 HttpQSCollection 类型，该类型是 NameValueCollection 的派生类型且不对外公开，所以你也无法通过 new 关键字来创建 HttpQSCollection 类型
此方法生成的查询字符串只会转义 value 且不包含前导字符 ?
Microsoft.AspNetCore.Http.QueryString 此方法仅适用于 SDK 为 Microsoft.NET.Sdk.Web 的项目
var queryString = QueryString.Create(new Dictionary&lt;string, string?> { ["a+b"] = "a%b", ["b"] = "2+1", })....</p></div><footer class=entry-footer><span title='2023-02-04 13:57:23 +0800 +0800'>2023年2月4日</span></footer><a class=entry-link aria-label="post link to 生成 HTTP 查询字符串" href=https://blog.fissssssh.com/posts/generate-http-query-string/></a></article><article class=post-entry><header class=entry-header><h2>在 Hugo 中集成 utterances 评论组件</h2></header><div class=entry-content><p>utterances 是基于 GitHub issues 构建的轻量级评论小部件，通过此组件可以将 Github issues 应用于任何网站
前置条件 一个公开的 github repo 在该 repo 中安装utterances app 简单集成 打开utterances官网
在 configuration 节点填写 repo 信息等，填写好后会生成对应的组件代码
我使用的是 PaperMod1 主题，将生成好的代码放入layouts/partials/comments.html
&lt;!--layouts/partials/comments.html--> &lt;script src="https://utteranc.es/client.js" repo="[ENTER REPO HERE]" issue-term="pathname" theme="github-light" label="Comment" crossorigin="anonymous" async >&lt;/script> 然后在config.yaml中开启评论功能即可简单集成
params: comments: true 动态主题适配 PaperMod 有明亮和暗黑两种颜色模式，而 utterances 的主题是编码时就写在script标签中的，为了使 comments 组件的主题适配 PaperMod 颜色主题，有以下两个步骤：
主题动态初始化 &lt;!-- layouts/partials/comments.html --> &lt;script> (function () { let theme = localStorage.getItem("pref-theme"); // already has prefer theme if (theme) { theme = theme === "dark" ?...</p></div><footer class=entry-footer><span title='2023-01-24 02:22:36 +0800 +0800'>2023年1月24日</span></footer><a class=entry-link aria-label="post link to 在 Hugo 中集成 utterances 评论组件" href=https://blog.fissssssh.com/posts/integrate-utterances-in-hugo/></a></article><article class=post-entry><header class=entry-header><h2>Newtonsoft.Json 小技巧</h2></header><div class=entry-content><p>Newtonsoft.Json 是一个非常受欢迎的 .NET JSON 框架
一般来说大部分用户用到的方法主要就是 JsonConvert.SerializeObject 和 JsonConvert.DeserializeObject 方法
前者用于将 .NET 对象 序列化为 JSON 字符串，后者则是将 JSON 字符串反序列化为 .NET 对象
下面我将讲述一些你可能用过或者没用过的一些小技巧
填充对象 我现在有一个 {"name":"fissssssh"} JSON 对象，当将它转为Dictionary&lt;string,string>后，可以通过键名name获取属性值
然而这个 JSON 现在变成 {"Name":"fissssssh"}, 无法再通过键名 name 获取属性值
Dictionary 是支持替换键名比较器的，但是 JsonConvert.DeserializeObject 只会调用其无参构造函数
我们可以手动将 Dictionary 创建出来, 然后通过 JsonConvert.PopulateObject 方法将 JSON 字符串序列化并填充至指定对象，代码如下
var json = "{\"Name\":\"fissssssh\"}"; // 创建一个键名忽略大小写的字典对象 var dict = new Dictionary&lt;string,string>(StringComparer.InvariantCultureIgnoreCase); JsonConvert.PopulateObject(json, dict); // 使用 name 获取 JSON 中的 Name 属性值 var name = dict["name"];</p></div><footer class=entry-footer><span title='2023-01-17 17:06:58 +0800 +0800'>2023年1月17日</span></footer><a class=entry-link aria-label="post link to Newtonsoft.Json 小技巧" href=https://blog.fissssssh.com/posts/newtonsoft-json-tips/></a></article><article class=post-entry><header class=entry-header><h2>使用 Visual Studio 调试 dapr 应用程序</h2></header><div class=entry-content><p>dapr 应用程序是一个多进程程序，对于 Visual Studio 来说可能比较困难
这里介绍两种方法来使用 Visual Studio 调试 dapr 应用程序
使用 VS 扩展 附加进程调试 使用 VS 扩展 参考 https://github.com/dapr/dotnet-sdk/issues/401#issuecomment-747563695
准备条件 安装 PowerShell 7 / Core 也可使用 dotnet tool install --global PowerShell 进行安装
安装 VS 扩展 Microsoft Child Process Debugging Power Tool 2022 调试准备 编辑launchSettings.json
{ "$schema": "https://json.schemastore.org/launchsettings.json", "profiles": { "WebApplication1": { "commandName": "Project", "dotnetRunMessages": true, "launchBrowser": true, "launchUrl": "weatherforecast", "applicationUrl": "http://localhost:5217", "environmentVariables": { "ASPNETCORE_ENVIRONMENT": "Development" } }, "Dapr-PWSH": { "commandName": "Executable", "executablePath": "pwsh", "commandLineArgs": "-Command \"dapr run -a myapp -p 5217 -- dotnet run --no-build\"", "workingDirectory": "....</p></div><footer class=entry-footer><span title='2023-01-05 15:40:18 +0800 +0800'>2023年1月5日</span></footer><a class=entry-link aria-label="post link to 使用 Visual Studio 调试 dapr 应用程序" href=https://blog.fissssssh.com/posts/debug-program-start-by-dapr-with-visual-studio/></a></article><article class=post-entry><header class=entry-header><h2>ASP.NET Core 中使用 Dapr 发布订阅</h2></header><div class=entry-content><p>定义 subpub 组件 我们使用 Dapr 初始化时安装的 redis 作为 pubsub 的实现
创建文件 ~/.dapr/components/pubsub.yaml （Windows 用户为 %USERPROFILE%\.dapr\components\pubsub.yaml ），内容如下
Dapr 初始化后 ~/.dapr/components 文件夹会自动创建，里面有一个 statestore.yaml 的组件定义。如果没有该文件夹也不用担心，手动创建即可
apiVersion: dapr.io/v1alpha1 kind: Component metadata: name: pubsub spec: type: pubsub.redis version: v1 metadata: - name: redisHost value: localhost:6379 - name: redisPassword value: "" 创建项目 创建 ASP.NET Core WebAPI 项目
$ dotnet new webapi --no-openapi --no-https 安装 Dapr SDK
dotnet CLI
$ dotnet add package Dapr.AspNetCore 程序包管理器控制台
Install-Package Dapr.AspNetCore 也可以在 Visual Studio 的 Nuget 包管理器中搜索安装...</p></div><footer class=entry-footer><span title='2022-12-14 22:25:34 +0800 +0800'>2022年12月14日</span></footer><a class=entry-link aria-label="post link to ASP.NET Core 中使用 Dapr 发布订阅" href=https://blog.fissssssh.com/posts/dapr-publish-and-subscription-in-asp-net-core/></a></article><article class=post-entry><header class=entry-header><h2>安装 Dapr</h2></header><div class=entry-content><p>前置条件 Dapr 可以脱离 Docker 运行，但不在本篇所讲范围内，本篇内容中的操作都是基于 Docker 安装完成并运行正常的情况下的操作
Docker Docker 安装官方文档描述十分清晰。 Windows 用户推荐安装带界面的 Docker Desktop（更符合 Windows 人的操作习惯吧），Linux 用户安装 Docker Engine 即可。
开始安装 Dapr 的安装分为两部分：
安装 Dapr CLI 安装 Dapr Runtime 有两种方式可以进行安装，在线安装方式会去 github 下载对应的资源，网络不好的同学可以使用离线安装的方式
在线安装 安装 Dapr CLI
Dapr 官网有各个操作系统详细的安装方法，这里讲一下通用的二进制安装方法：
首先去 Dapr CLI 的发布页（目前最新是 1.9.1 版本）下载对应操作系统版本的压缩包，命名格式为dapr_&lt;os_name>_&lt;cpu_arch>.(tar.gz|zip)，如果操作系统或者 CPU 架构没选对，则 Dapr CLI 无法正常运行 通常来说 Windows 用户下载dapr_windows_amd64.zip，Linux 用户下载dapr_linux_amd64.tar.gz
解压到任意文件夹，并将该文件夹路径加入PATH环境变量 Linux 用户可直接创建软连接到/usr/local/bin/dapr， Windows 用户推荐将文件解压至%USERPROFILE%\bin\文件夹，并将%USERPROFILE%\bin\添加到PATH环境变量中，后续有其他的可执行文件也可以放入该文件夹，不用再动环境变量
打开控制台或者终端输入dapr，如果有相关的内容输出则安装成功 安装 Dapr Runtime
安装 Dapr Runtime 也叫初始化 Dapr。
本地 Dapr 环境的初始化很简单， 只需要dapr init即可...</p></div><footer class=entry-footer><span title='2022-12-14 16:39:07 +0800 +0800'>2022年12月14日</span></footer><a class=entry-link aria-label="post link to 安装 Dapr" href=https://blog.fissssssh.com/posts/dapr/install/></a></article><article class=post-entry><header class=entry-header><h2>Run Clash With Docker Desktop</h2></header><div class=entry-content><p>创建docker-compose.yml version: '3.9' services: clash: container_name: core image: dreamacro/clash volumes: - ./config.yaml:/root/.config/clash/config.yaml:ro ports: - "7890:7890" # proxy port(change port to your config.yaml) - "9090:9090" # api port(change port to your config.yaml) restart: always yacd: container_name: web_ui image: haishanh/yacd ports: - "80:80" # change port which you want depends_on: - clash restart: always 启动 把你的clash配置文件 config.yaml 和 docker-compose.yml 放入同一个文件夹
然后执行 docker compose up -d 启动
打开 http://localhost:&lt;your_yacd_exposed_port> 进入web UI 可以管理切换clash的节点和代理模式
设置系统代理 在 系统设置 -> 网络和Internet -> 代理 -> 手动设置代理 中填写clash暴露的http端口...</p></div><footer class=entry-footer><span title='2022-07-09 12:21:08 +0800 +0800'>2022年7月9日</span></footer><a class=entry-link aria-label="post link to Run Clash With Docker Desktop" href=https://blog.fissssssh.com/posts/run-clash-with-docker-desktop/></a></article><article class=post-entry><header class=entry-header><h2>Visual Studio 2022 插件推荐</h2></header><div class=entry-content><p>引言 插件可以提高开发人员的生产力，好的插件可以让开发事半功倍，下面推荐一些自己用的 Visual Studio 插件（免费！）
插件列表 以下所有插件在 Visual Studio 2022 运行正常，若版本不兼容请移步 Visual Studio Marketplace 查看是否有对应版本
插件名称 描述 CodeMaid VS2022 代码清理插件，其中有一个码锹窗口深得我心 Output enhancer 输出窗口使用彩色优化，错误为红色，警告为黄色等 Code alignment 代码对齐，让你的某些代码按照某个字符垂直对齐 Double-Click Maximize 2022 双击最大化，不用先拖出来再放大，再次双击即可回归原位 Time Stamp Margin 2022 在调试窗口左边增加一列时间戳 Shrink Empty Lines 2022 压缩空行和没有字符的行（只有括号的行）的高度，从而在屏幕上显示更多代码 Solution Error Visualizer 2022 当某个文件有错误或者警告时，在解决方案资源管理器中显示（其父目录也会显示） Match Margin 2022 在滚动条上显示当前选中单词的位置</p></div><footer class=entry-footer><span title='2022-07-07 16:35:39 +0800 +0800'>2022年7月7日</span></footer><a class=entry-link aria-label="post link to Visual Studio 2022 插件推荐" href=https://blog.fissssssh.com/posts/recommended-visual-studio-plugins/></a></article><article class=post-entry><header class=entry-header><h2>如何在 ASP.NET Core WEB API 中启动后台任务</h2></header><div class=entry-content><p>引言 有时候我们可能想在接口中开启一个后台任务，就像这样:
public class MyController : Controller { private readonly MyDependency _dep; public MyController(MyDependency d) { _dep = d; } public IActionResult MyAction() { Task.Run(() => _dep.DoHeavyAsyncWork()); return Json("Your job is started!"); } } 事实上，这段代码很符合语义，接口也能成功返回。 但是其中有一个潜在问题，随着return语句响应本次请求，ASP.NET Core会开始释放本次请求的依赖，比如控制器和控制器依赖的各种服务……，这就会导致Task.Run语句中的所依赖的定义在控制器中的服务会被释放掉，这可能会导致一些未知的问题。这些潜在问题可能会让你的应用程序随时爆炸！
让后台任务拥有自己的生存期 为了保证后台服务的依赖不随控制器释放而释放，我们需要定义一个新的服务并将其注册为单例服务，因为单例服务永远不会被释放。
创建一个名为CannonService的类
CannonService.cs
public class CannonService { private readonly ILogger&lt;CannonService> _logger; private readonly IServiceProvider _serviceProvider; public CannonService(ILogger&lt;CannonService> logger, IServiceProvider serviceProvider) { _logger = logger; _serviceProvider = serviceProvider; } public void Fire(Delegate dg, Action&lt;Exception>?...</p></div><footer class=entry-footer><span title='2022-06-27 20:30:49 +0800 +0800'>2022年6月27日</span></footer><a class=entry-link aria-label="post link to 如何在 ASP.NET Core WEB API 中启动后台任务" href=https://blog.fissssssh.com/posts/how-to-start-backgroud-task-in-asp_net_core_webapi/></a></article><article class=post-entry><header class=entry-header><h2>Create Redis Cluster by Docker Compose</h2></header><div class=entry-content><p>Create a docker-compose.yml version: "3.9" services: redis-1: image: redis:7.0.2-alpine container_name: redis-1 ports: - "6371:6371" - "16371:16371" volumes: - ./node-1/data:/data - ./node-1/conf/redis.conf:/etc/redis/redis.conf networks: redis: ipv4_address: 172.28.0.11 command: - "redis-server" - "/etc/redis/redis.conf" redis-2: image: redis:7.0.2-alpine container_name: redis-2 ports: - "6372:6372" - "16372:16372" volumes: - ./node-2/data:/data - ./node-2/conf/redis.conf:/etc/redis/redis.conf networks: redis: ipv4_address: 172.28.0.12 command: - "redis-server" - "/etc/redis/redis.conf" redis-3: image: redis:7.0.2-alpine container_name: redis-3 ports: - "6373:6373" - "16373:16373" volumes: - ./node-3/data:/data - ./node-3/conf/redis.conf:/etc/redis/redis.conf networks: redis: ipv4_address: 172....</p></div><footer class=entry-footer><span title='2022-06-21 15:52:38 +0800 +0800'>2022年6月21日</span></footer><a class=entry-link aria-label="post link to Create Redis Cluster by Docker Compose" href=https://blog.fissssssh.com/posts/create-redis-cluster-by-docker-compose/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://blog.fissssssh.com/page/2/>下一页&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2023 <a href=https://blog.fissssssh.com/>fissssssh</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector(".utterances-frame"),t={type:"set-theme",theme:localStorage.getItem("pref-theme")==="light"?"github-dark":"github-light"};e?.contentWindow.postMessage(t,"https://utteranc.es")})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>