<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>文章 | fissssssh</title><meta name=keywords content><meta name=description content="文章 - fissssssh"><meta name=author content><link rel=canonical href=https://blog.fissssssh.com/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://blog.fissssssh.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.fissssssh.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.fissssssh.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.fissssssh.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.fissssssh.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://blog.fissssssh.com/posts/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href="https://fonts.googleapis.com/css?family=JetBrains+Mono&display=swap"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><meta property="og:title" content="文章"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://blog.fissssssh.com/posts/"><meta name=twitter:card content="summary"><meta name=twitter:title content="文章"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://blog.fissssssh.com/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.fissssssh.com/ accesskey=h title="fissssssh (Alt + H)">fissssssh</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.fissssssh.com/posts/ title=文章><span class=active>文章</span></a></li><li><a href=https://blog.fissssssh.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.fissssssh.com/tags/ title=标签><span>标签</span></a></li><li><a href=https://blog.fissssssh.com/links/ title=友链><span>友链</span></a></li><li><a href=https://blog.fissssssh.com/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>文章</h1></header><article class=post-entry><header class=entry-header><h2>如何在 ASP.NET Core WEB API 中启动后台任务</h2></header><div class=entry-content><p>引言 有时候我们可能想在接口中开启一个后台任务，就像这样:
public class MyController : Controller { private readonly MyDependency _dep; public MyController(MyDependency d) { _dep = d; } public IActionResult MyAction() { Task.Run(() => _dep.DoHeavyAsyncWork()); return Json("Your job is started!"); } } 事实上，这段代码很符合语义，接口也能成功返回。 但是其中有一个潜在问题，随着return语句响应本次请求，ASP.NET Core会开始释放本次请求的依赖，比如控制器和控制器依赖的各种服务……，这就会导致Task.Run语句中的所依赖的定义在控制器中的服务会被释放掉，这可能会导致一些未知的问题。这些潜在问题可能会让你的应用程序随时爆炸！
让后台任务拥有自己的生存期 为了保证后台服务的依赖不随控制器释放而释放，我们需要定义一个新的服务并将其注册为单例服务，因为单例服务永远不会被释放。
创建一个名为CannonService的类
CannonService.cs
public class CannonService { private readonly ILogger&lt;CannonService> _logger; private readonly IServiceProvider _serviceProvider; public CannonService(ILogger&lt;CannonService> logger, IServiceProvider serviceProvider) { _logger = logger; _serviceProvider = serviceProvider; } public void Fire(Delegate dg, Action&lt;Exception>?...</p></div><footer class=entry-footer><span title='2022-06-27 20:30:49 +0800 +0800'>2022年6月27日</span></footer><a class=entry-link aria-label="post link to 如何在 ASP.NET Core WEB API 中启动后台任务" href=https://blog.fissssssh.com/posts/how-to-start-backgroud-task-in-asp_net_core_webapi/></a></article><article class=post-entry><header class=entry-header><h2>Create Redis Cluster by Docker Compose</h2></header><div class=entry-content><p>Create a docker-compose.yml version: "3.9" services: redis-1: image: redis:7.0.2-alpine container_name: redis-1 ports: - "6371:6371" - "16371:16371" volumes: - ./node-1/data:/data - ./node-1/conf/redis.conf:/etc/redis/redis.conf networks: redis: ipv4_address: 172.28.0.11 command: - "redis-server" - "/etc/redis/redis.conf" redis-2: image: redis:7.0.2-alpine container_name: redis-2 ports: - "6372:6372" - "16372:16372" volumes: - ./node-2/data:/data - ./node-2/conf/redis.conf:/etc/redis/redis.conf networks: redis: ipv4_address: 172.28.0.12 command: - "redis-server" - "/etc/redis/redis.conf" redis-3: image: redis:7.0.2-alpine container_name: redis-3 ports: - "6373:6373" - "16373:16373" volumes: - ./node-3/data:/data - ./node-3/conf/redis.conf:/etc/redis/redis.conf networks: redis: ipv4_address: 172....</p></div><footer class=entry-footer><span title='2022-06-21 15:52:38 +0800 +0800'>2022年6月21日</span></footer><a class=entry-link aria-label="post link to Create Redis Cluster by Docker Compose" href=https://blog.fissssssh.com/posts/create-redis-cluster-by-docker-compose/></a></article><article class=post-entry><header class=entry-header><h2>Css Integrity Error When Load Hugo Publish</h2></header><div class=entry-content><p>问题描述 近日我使用 hugo 构建了我的博客，并通过 Github Action 将其发布在 Github Pages 上，刚开始还是很美好的，但是过一短时间以后打开页面发现样式全无，使用浏览器的开发者工具查看资源获取没有问题，但是在控制台却出现了这样一句话：
Failed to find a valid digest in the 'integrity' attribute for resource '***' with computed SHA-256 integrity '***'. The resource has been blocked. 寻找原因 我在 MDN 上寻找到了关于 integrity 的定义，大概描述就是这是一个签名，浏览器获取到相应资源后会用相同的方法计算一个签名，只有签名相同时才会加载对应的资源，如果两个签名不一致则是文件完整性被破坏（文件发生了改变）。
问题来了，整个发布过程是由 Github Action 全自动操作的，没有人为干预，文件为何会无缘无故改变呢？
答案是 Cloudflare。 Cloudflare 中默认会开启静态资源的缓存来提高网站的加载速度，可是为什么缓存会改变文件呢？缓存并不会改变文件，在 Cloudflare 的 Speed > Optimization 中有一个叫 Auto Minify 的选项，描述如下：
Reduce the file size of source code on your website.
Note: Purge cache to have your change take effect immediately....</p></div><footer class=entry-footer><span title='2022-06-20 21:30:04 +0800 +0800'>2022年6月20日</span></footer><a class=entry-link aria-label="post link to Css Integrity Error When Load Hugo Publish" href=https://blog.fissssssh.com/posts/css-integrity-error-when-load-hugo-publish/></a></article><article class=post-entry><header class=entry-header><h2>Code Snippets in VSCode</h2></header><div class=entry-content><p>Introduction VSCode(Visual Studio Code) is a code editor redefined and optimized for building and debugging modern web and cloud applications.
Code Snippets is a piece of code, the editor will auto complete a specific code when developer type some specific prefixes.
Custom Code Snippets VSCode has many built-in code snippets, so I won’t go into details here, but mainly talk about how to customize code snippets.
There are two types of code snippets, one is global and the other is workspace, the difference between them is that the scope and storage location....</p></div><footer class=entry-footer><span title='2022-06-19 21:55:10 +0800 +0800'>2022年6月19日</span></footer><a class=entry-link aria-label="post link to Code Snippets in VSCode" href=https://blog.fissssssh.com/posts/code-snippets.in-vscode/></a></article><article class=post-entry><header class=entry-header><h2>软件推荐</h2></header><div class=entry-content><p>以下是我本人平时喜欢用的软件，排名不分先后
名称 描述 类型 7-Zip 压缩软件 desktop Fiddler HTTP 抓包工具 desktop Git 代码管理软件 cli,desktop Google Chrome 顶级浏览器 desktop MPC-HC 视频播放器 desktop MSI Afterburner 性能监视超频软件 desktop MacType Windows 字体渲染 desktop OBS Studio 推流工具 desktop PowerToys Windows 小工具集合 desktop Sourcetree 代码管理软件 desktop ToDesk 远程桌面工具 desktop Virtual Audio Cable 音频管理软件 desktop Visual Studio Code 吃饭的家伙 desktop Visual Studio 吃饭的家伙 desktop Voicemetter Banana 音频管理软件 desktop WinHex 文件查看工具 desktop WinSCP 文件复制工具 desktop WinaeroTweaker Windows 工具 desktop WireShark 网络抓包工具 desktop Wiztree 磁盘分析工具 desktop dnSpy ....</p></div><footer class=entry-footer><span title='2022-06-16 20:08:22 +0800 +0800'>2022年6月16日</span></footer><a class=entry-link aria-label="post link to 软件推荐" href=https://blog.fissssssh.com/posts/recommended-software/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://blog.fissssssh.com/posts/>«&nbsp;上一页&nbsp;</a></nav></footer></main><footer class=footer><span>&copy; 2023 <a href=https://blog.fissssssh.com/>fissssssh</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector(".utterances-frame"),t={type:"set-theme",theme:localStorage.getItem("pref-theme")==="light"?"github-dark":"github-light"};e?.contentWindow.postMessage(t,"https://utteranc.es")})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>