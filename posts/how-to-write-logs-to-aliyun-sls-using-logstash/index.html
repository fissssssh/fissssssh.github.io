<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>如何使用Logstash将日志写入阿里云SLS服务 | fissssssh</title><meta name=keywords content="ELK,K8s"><meta name=description content="当你的应用程序越来越大，日志的管理变得越来越困难。而将日志存储在云服务上是现代化应用中的一个不可忽视的方面。在云服务中，阿里云 SLS 是一个非常好的选择，它可以帮助你收集、存储和查询应用程序日志。但是，如何将应用程序的日志发送到阿里云 SLS 服务呢？今天，我们将使用 Logstash，一个流行的开源工具，来将我们的日志发送到阿里云 SLS 服务中。
简介 阿里云 SLS 服务 阿里云 SLS（云监控日志服务）是一种高可靠、高扩展性的日志服务，主要用于收集和实时处理来自服务器、应用程序和云产品的日志数据。 SLS 提供了实时的查询、统计和报警等功能，有助于用户更轻松地管理日志。
SLS 支持大规模的日志数据处理，可以通过多种方式上传日志数据，例如 SDK、API、SLS Agent、Logstash 等，使用 SLS 可以快速查询、分析和可视化日志数据，帮助用户更好地理解自己的应用环境。
Logstash Logstash 则是一款通用的日志收集工具，可以将来自不同来源的日志数据进行收集、处理、转换和传输。Logstash 可以与各种插件配合使用，从而实现更多功能。例如，用户可以使用 Logstash 的 input 插件来收集来自多个来源的日志数据，使用 filter 插件来解析、过滤和重构这些数据，最后使用 output 插件将处理后的数据发送到各种目的地，如 Elasticsearch、Kibana 等。
准备工作 创建阿里云 SLS 服务实例 略
安装 Logstash 本文使用的 Logstash 版本为 8.7.0（截至本文发布最新版）
阿里云官方文档介绍了如何安装 Logstash，但如果要在 K8s 中运行则需要进行一些其他操作：
构建带有 logstash-output-logservice 插件的 Logstash 镜像 编写 Logstash 配置文件 部署至 K8s 构建镜像 通过 Dockerfile 来构建包含 logstash-output-logservice 插件的 Logstash 镜像，文件内容如下："><meta name=author content><link rel=canonical href=https://blog.fissssssh.com/posts/how-to-write-logs-to-aliyun-sls-using-logstash/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://blog.fissssssh.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.fissssssh.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.fissssssh.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.fissssssh.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.fissssssh.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href="https://fonts.googleapis.com/css?family=JetBrains+Mono&display=swap"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css><meta property="og:title" content="如何使用Logstash将日志写入阿里云SLS服务"><meta property="og:description" content="当你的应用程序越来越大，日志的管理变得越来越困难。而将日志存储在云服务上是现代化应用中的一个不可忽视的方面。在云服务中，阿里云 SLS 是一个非常好的选择，它可以帮助你收集、存储和查询应用程序日志。但是，如何将应用程序的日志发送到阿里云 SLS 服务呢？今天，我们将使用 Logstash，一个流行的开源工具，来将我们的日志发送到阿里云 SLS 服务中。
简介 阿里云 SLS 服务 阿里云 SLS（云监控日志服务）是一种高可靠、高扩展性的日志服务，主要用于收集和实时处理来自服务器、应用程序和云产品的日志数据。 SLS 提供了实时的查询、统计和报警等功能，有助于用户更轻松地管理日志。
SLS 支持大规模的日志数据处理，可以通过多种方式上传日志数据，例如 SDK、API、SLS Agent、Logstash 等，使用 SLS 可以快速查询、分析和可视化日志数据，帮助用户更好地理解自己的应用环境。
Logstash Logstash 则是一款通用的日志收集工具，可以将来自不同来源的日志数据进行收集、处理、转换和传输。Logstash 可以与各种插件配合使用，从而实现更多功能。例如，用户可以使用 Logstash 的 input 插件来收集来自多个来源的日志数据，使用 filter 插件来解析、过滤和重构这些数据，最后使用 output 插件将处理后的数据发送到各种目的地，如 Elasticsearch、Kibana 等。
准备工作 创建阿里云 SLS 服务实例 略
安装 Logstash 本文使用的 Logstash 版本为 8.7.0（截至本文发布最新版）
阿里云官方文档介绍了如何安装 Logstash，但如果要在 K8s 中运行则需要进行一些其他操作：
构建带有 logstash-output-logservice 插件的 Logstash 镜像 编写 Logstash 配置文件 部署至 K8s 构建镜像 通过 Dockerfile 来构建包含 logstash-output-logservice 插件的 Logstash 镜像，文件内容如下："><meta property="og:type" content="article"><meta property="og:url" content="https://blog.fissssssh.com/posts/how-to-write-logs-to-aliyun-sls-using-logstash/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-24T16:22:05+08:00"><meta property="article:modified_time" content="2023-04-24T16:22:05+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="如何使用Logstash将日志写入阿里云SLS服务"><meta name=twitter:description content="当你的应用程序越来越大，日志的管理变得越来越困难。而将日志存储在云服务上是现代化应用中的一个不可忽视的方面。在云服务中，阿里云 SLS 是一个非常好的选择，它可以帮助你收集、存储和查询应用程序日志。但是，如何将应用程序的日志发送到阿里云 SLS 服务呢？今天，我们将使用 Logstash，一个流行的开源工具，来将我们的日志发送到阿里云 SLS 服务中。
简介 阿里云 SLS 服务 阿里云 SLS（云监控日志服务）是一种高可靠、高扩展性的日志服务，主要用于收集和实时处理来自服务器、应用程序和云产品的日志数据。 SLS 提供了实时的查询、统计和报警等功能，有助于用户更轻松地管理日志。
SLS 支持大规模的日志数据处理，可以通过多种方式上传日志数据，例如 SDK、API、SLS Agent、Logstash 等，使用 SLS 可以快速查询、分析和可视化日志数据，帮助用户更好地理解自己的应用环境。
Logstash Logstash 则是一款通用的日志收集工具，可以将来自不同来源的日志数据进行收集、处理、转换和传输。Logstash 可以与各种插件配合使用，从而实现更多功能。例如，用户可以使用 Logstash 的 input 插件来收集来自多个来源的日志数据，使用 filter 插件来解析、过滤和重构这些数据，最后使用 output 插件将处理后的数据发送到各种目的地，如 Elasticsearch、Kibana 等。
准备工作 创建阿里云 SLS 服务实例 略
安装 Logstash 本文使用的 Logstash 版本为 8.7.0（截至本文发布最新版）
阿里云官方文档介绍了如何安装 Logstash，但如果要在 K8s 中运行则需要进行一些其他操作：
构建带有 logstash-output-logservice 插件的 Logstash 镜像 编写 Logstash 配置文件 部署至 K8s 构建镜像 通过 Dockerfile 来构建包含 logstash-output-logservice 插件的 Logstash 镜像，文件内容如下："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://blog.fissssssh.com/posts/"},{"@type":"ListItem","position":2,"name":"如何使用Logstash将日志写入阿里云SLS服务","item":"https://blog.fissssssh.com/posts/how-to-write-logs-to-aliyun-sls-using-logstash/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"如何使用Logstash将日志写入阿里云SLS服务","name":"如何使用Logstash将日志写入阿里云SLS服务","description":"当你的应用程序越来越大，日志的管理变得越来越困难。而将日志存储在云服务上是现代化应用中的一个不可忽视的方面。在云服务中，阿里云 SLS 是一个非常好的选择，它可以帮助你收集、存储和查询应用程序日志。但是，如何将应用程序的日志发送到阿里云 SLS 服务呢？今天，我们将使用 Logstash，一个流行的开源工具，来将我们的日志发送到阿里云 SLS 服务中。\n简介 阿里云 SLS 服务 阿里云 SLS（云监控日志服务）是一种高可靠、高扩展性的日志服务，主要用于收集和实时处理来自服务器、应用程序和云产品的日志数据。 SLS 提供了实时的查询、统计和报警等功能，有助于用户更轻松地管理日志。\nSLS 支持大规模的日志数据处理，可以通过多种方式上传日志数据，例如 SDK、API、SLS Agent、Logstash 等，使用 SLS 可以快速查询、分析和可视化日志数据，帮助用户更好地理解自己的应用环境。\nLogstash Logstash 则是一款通用的日志收集工具，可以将来自不同来源的日志数据进行收集、处理、转换和传输。Logstash 可以与各种插件配合使用，从而实现更多功能。例如，用户可以使用 Logstash 的 input 插件来收集来自多个来源的日志数据，使用 filter 插件来解析、过滤和重构这些数据，最后使用 output 插件将处理后的数据发送到各种目的地，如 Elasticsearch、Kibana 等。\n准备工作 创建阿里云 SLS 服务实例 略\n安装 Logstash 本文使用的 Logstash 版本为 8.7.0（截至本文发布最新版）\n阿里云官方文档介绍了如何安装 Logstash，但如果要在 K8s 中运行则需要进行一些其他操作：\n构建带有 logstash-output-logservice 插件的 Logstash 镜像 编写 Logstash 配置文件 部署至 K8s 构建镜像 通过 Dockerfile 来构建包含 logstash-output-logservice 插件的 Logstash 镜像，文件内容如下：","keywords":["ELK","K8s"],"articleBody":"当你的应用程序越来越大，日志的管理变得越来越困难。而将日志存储在云服务上是现代化应用中的一个不可忽视的方面。在云服务中，阿里云 SLS 是一个非常好的选择，它可以帮助你收集、存储和查询应用程序日志。但是，如何将应用程序的日志发送到阿里云 SLS 服务呢？今天，我们将使用 Logstash，一个流行的开源工具，来将我们的日志发送到阿里云 SLS 服务中。\n简介 阿里云 SLS 服务 阿里云 SLS（云监控日志服务）是一种高可靠、高扩展性的日志服务，主要用于收集和实时处理来自服务器、应用程序和云产品的日志数据。 SLS 提供了实时的查询、统计和报警等功能，有助于用户更轻松地管理日志。\nSLS 支持大规模的日志数据处理，可以通过多种方式上传日志数据，例如 SDK、API、SLS Agent、Logstash 等，使用 SLS 可以快速查询、分析和可视化日志数据，帮助用户更好地理解自己的应用环境。\nLogstash Logstash 则是一款通用的日志收集工具，可以将来自不同来源的日志数据进行收集、处理、转换和传输。Logstash 可以与各种插件配合使用，从而实现更多功能。例如，用户可以使用 Logstash 的 input 插件来收集来自多个来源的日志数据，使用 filter 插件来解析、过滤和重构这些数据，最后使用 output 插件将处理后的数据发送到各种目的地，如 Elasticsearch、Kibana 等。\n准备工作 创建阿里云 SLS 服务实例 略\n安装 Logstash 本文使用的 Logstash 版本为 8.7.0（截至本文发布最新版）\n阿里云官方文档介绍了如何安装 Logstash，但如果要在 K8s 中运行则需要进行一些其他操作：\n构建带有 logstash-output-logservice 插件的 Logstash 镜像 编写 Logstash 配置文件 部署至 K8s 构建镜像 通过 Dockerfile 来构建包含 logstash-output-logservice 插件的 Logstash 镜像，文件内容如下：\nFROM docker.elastic.co/logstash/logstash:8.7.0 RUN ./bin/logstash-plugin install logstash-output-logservice 在 Dockerfile 所在目录执行构建命令\n$ docker build -t logstash-output-logservice:v1.0.0 . 配置文件 logstash.yml\nhttp.host: \"0.0.0.0\" 默认的 logstash.yml 中包含 elasticsearch 的终结点配置，不删掉该配置会在 Logstash 的日志中输出一些 WARNING\nlogstash.conf\ninput { beats { port =\u003e \"5044\" } } output { logservice { codec =\u003e \"json\" endpoint =\u003e \"***\" project =\u003e \"***\" logstore =\u003e \"***\" topic =\u003e \"\" source =\u003e \"\" access_key_id =\u003e \"***\" access_key_secret =\u003e \"***\" to_json =\u003e true max_send_retry =\u003e 10 max_buffer_items =\u003e 4000 max_buffer_bytes =\u003e 2097152 max_buffer_seconds =\u003e 3 } } logstash.conf 为管道配置文件，包含input，filter 和 output 三部分，分别定义了输入，过滤器和输出，这里是简单介绍就不写过滤器\naccess_key 必须具有 log:PostLogStoreLogs 权限才能写入日志\n部署 为了将 Logstash 部署至 K8s 中，我们还需要编写对应的资源文件：\nlogstash.yml\napiVersion: v1 kind: ConfigMap metadata: name: logstash data: logstash.yml: |- http.host: \"0.0.0.0\" logstash.conf: |- input { beats { port =\u003e \"5044\" } } output { logservice { codec =\u003e \"json\" endpoint =\u003e \"***\" project =\u003e \"***\" logstore =\u003e \"***\" topic =\u003e \"\" source =\u003e \"\" access_key_id =\u003e \"***\" access_key_secret =\u003e \"***\" to_json =\u003e true max_send_retry =\u003e 10 max_buffer_items =\u003e 4000 max_buffer_bytes =\u003e 2097152 max_buffer_seconds =\u003e 3 } } --- apiVersion: apps/v1 kind: Deployment metadata: name: logstash labels: app: logstash spec: replicas: 1 selector: matchLabels: app: logstash template: metadata: labels: app: logstash spec: containers: - name: logstash image: logstash-output-logservice:v1.0.0 imagePullPolicy: IfNotPresent ports: - containerPort: 5044 name: beats - containerPort: 9600 name: http volumeMounts: - name: config mountPath: /usr/share/logstash/pipeline/logstash.conf subPath: logstash.conf - name: config mountPath: /usr/share/logstash/config/logstash.yml subPath: logstash.yml resources: limits: cpu: 1000m memory: 2Gi requests: cpu: 500m memory: 1Gi volumes: - name: config configMap: name: logstash --- apiVersion: v1 kind: Service metadata: name: logstash labels: app: logstash spec: selector: app: logstash ports: - name: beats port: 5044 targetPort: beats - name: http port: 9600 targetPort: http 使用以下指令部署：\n$ kubectl apply -f logstash.yml 部署成功后通过 kubectl get po 可以看到正常运行的 Logstash\n$ kubectl get po NAME READY STATUS RESTARTS AGE logstash-67758cfc7b-n4xm5 1/1 Running 0 2m 测试 上面的配置中 input 配置为了 beats，所以我们使用 Filebeat 来进行测试\n本文使用的 Filebeat 版本为 8.7.0\n运行 filebeat filebeat.yml apiVersion: v1 kind: ConfigMap metadata: name: filebeat data: filebeat.yml: |- filebeat.inputs: - type: log paths: - /usr/share/filebeat/logs/test.log output.logstash: hosts: [\"logstash:5044\"] --- apiVersion: apps/v1 kind: Deployment metadata: name: filebeat labels: app: filebeat spec: replicas: 1 selector: matchLabels: app: filebeat template: metadata: labels: app: filebeat spec: containers: - name: filebeat image: docker.elastic.co/beats/filebeat:8.7.0 volumeMounts: - name: config mountPath: /usr/share/filebeat/filebeat.yml subPath: filebeat.yml volumes: - name: config configMap: name: filebeat items: - key: filebeat.yml path: filebeat.yml 在 ConfigMap 中我们配置了监听容器内 /usr/share/filebeat/logs/test.log 文件的变化，并输出到 logstash:5044（此地址对应上一章节部署 Logstash 时的 Service 定义） 使用以下指令部署：\n$ kubectl apply -f filebeat.yml 部署成功后通过 kubectl get po 可以看到正常运行的 Logstash 和 Filebeat\n$ kubectl get po NAME READY STATUS RESTARTS AGE filebeat-b477d46fb-lr44n 1/1 Running 0 2m logstash-67758cfc7b-n4xm5 1/1 Running 0 5m 使用以下指令进行测试：\n# 进入 Filebeat 容器 $ kubectl exec -it filebeat-b477d46fb-lr44n -- bash # 使用 echo 指令模拟写日志到 logs/test.log filebeat@filebeat-b477d46fb-lr44n:~$ echo \"this is a test log 3\" \u003e\u003e logs/test.log filebeat@filebeat-b477d46fb-lr44n:~$ echo \"this is a test log 4\" \u003e\u003e logs/test.log filebeat@filebeat-b477d46fb-lr44n:~$ echo \"this is a test log 5\" \u003e\u003e logs/test.log 此时在 Logstash 容器的日志中可以看到以下输出：\n[2023-04-24T08:10:58,826][INFO ][logstash.outputs.logservice][main] send logs to logservice success {:logcount=\u003e\"1\"} [2023-04-24T08:11:11,805][INFO ][logstash.outputs.logservice][main] send logs to logservice success {:logcount=\u003e\"1\"} [2023-04-24T08:11:12,303][INFO ][logstash.outputs.logservice][main] send logs to logservice success {:logcount=\u003e\"1\"} 表示我们的日志成功写到了阿里云 SLS 中，登录阿里云控制台进行查看：\n参考资料 Parsing Logs with Logstash 安装 Logstash 创建 Logstash 采集配置和处理配置 ","wordCount":"583","inLanguage":"zh","datePublished":"2023-04-24T16:22:05+08:00","dateModified":"2023-04-24T16:22:05+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.fissssssh.com/posts/how-to-write-logs-to-aliyun-sls-using-logstash/"},"publisher":{"@type":"Organization","name":"fissssssh","logo":{"@type":"ImageObject","url":"https://blog.fissssssh.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.fissssssh.com/ accesskey=h title="fissssssh (Alt + H)">fissssssh</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.fissssssh.com/posts/ title=文章><span>文章</span></a></li><li><a href=https://blog.fissssssh.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://blog.fissssssh.com/tags/ title=标签><span>标签</span></a></li><li><a href=https://blog.fissssssh.com/links/ title=友链><span>友链</span></a></li><li><a href=https://blog.fissssssh.com/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>如何使用Logstash将日志写入阿里云SLS服务</h1><div class=post-meta><span title='2023-04-24 16:22:05 +0800 +0800'>2023年4月24日</span>&nbsp;|&nbsp;<a href=https://github.com/fissssssh/fissssssh.github.io/edit/master/content/posts/how-to-write-logs-to-aliyun-sls-using-logstash/index.md rel="noopener noreferrer" target=_blank>编辑</a></div></header><div class=post-content><p>当你的应用程序越来越大，日志的管理变得越来越困难。而将日志存储在云服务上是现代化应用中的一个不可忽视的方面。在云服务中，阿里云 SLS 是一个非常好的选择，它可以帮助你收集、存储和查询应用程序日志。但是，如何将应用程序的日志发送到阿里云 SLS 服务呢？今天，我们将使用 Logstash，一个流行的开源工具，来将我们的日志发送到阿里云 SLS 服务中。</p><h1 id=简介>简介<a hidden class=anchor aria-hidden=true href=#简介>#</a></h1><h2 id=阿里云-sls-服务>阿里云 SLS 服务<a hidden class=anchor aria-hidden=true href=#阿里云-sls-服务>#</a></h2><p>阿里云 SLS（云监控日志服务）是一种高可靠、高扩展性的日志服务，主要用于收集和实时处理来自服务器、应用程序和云产品的日志数据。 SLS 提供了实时的查询、统计和报警等功能，有助于用户更轻松地管理日志。</p><p>SLS 支持大规模的日志数据处理，可以通过多种方式上传日志数据，例如 SDK、API、SLS Agent、Logstash 等，使用 SLS 可以快速查询、分析和可视化日志数据，帮助用户更好地理解自己的应用环境。</p><h2 id=logstash>Logstash<a hidden class=anchor aria-hidden=true href=#logstash>#</a></h2><p>Logstash 则是一款通用的日志收集工具，可以将来自不同来源的日志数据进行收集、处理、转换和传输。Logstash 可以与各种插件配合使用，从而实现更多功能。例如，用户可以使用 Logstash 的 input 插件来收集来自多个来源的日志数据，使用 filter 插件来解析、过滤和重构这些数据，最后使用 output 插件将处理后的数据发送到各种目的地，如 Elasticsearch、Kibana 等。</p><h1 id=准备工作>准备工作<a hidden class=anchor aria-hidden=true href=#准备工作>#</a></h1><h2 id=创建阿里云-sls-服务实例>创建阿里云 SLS 服务实例<a hidden class=anchor aria-hidden=true href=#创建阿里云-sls-服务实例>#</a></h2><p>略</p><h2 id=安装-logstash>安装 Logstash<a hidden class=anchor aria-hidden=true href=#安装-logstash>#</a></h2><blockquote><p>本文使用的 Logstash 版本为 <code>8.7.0</code>（截至本文发布最新版）</p></blockquote><p>阿里云<a href="https://help.aliyun.com/document_detail/49019.html?spm=a2c4g.28984.0.0.323e3e4awhfoI9">官方文档</a>介绍了如何安装 Logstash，但如果要在 K8s 中运行则需要进行一些其他操作：</p><ol><li>构建带有 <code>logstash-output-logservice</code> 插件的 Logstash 镜像</li><li>编写 <code>Logstash</code> 配置文件</li><li>部署至 K8s</li></ol><h3 id=构建镜像>构建镜像<a hidden class=anchor aria-hidden=true href=#构建镜像>#</a></h3><p>通过 Dockerfile 来构建包含 <code>logstash-output-logservice</code> 插件的 Logstash 镜像，文件内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#ff79c6>FROM</span><span style=color:#f1fa8c> docker.elastic.co/logstash/logstash:8.7.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>RUN</span> ./bin/logstash-plugin install logstash-output-logservice
</span></span></code></pre></div><p>在 Dockerfile 所在目录执行构建命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker build -t logstash-output-logservice:v1.0.0 .
</span></span></code></pre></div><h3 id=配置文件>配置文件<a hidden class=anchor aria-hidden=true href=#配置文件>#</a></h3><ul><li><p>logstash.yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>http.host</span>: <span style=color:#f1fa8c>&#34;0.0.0.0&#34;</span>
</span></span></code></pre></div><blockquote><p>默认的 <code>logstash.yml</code> 中包含 elasticsearch 的终结点配置，不删掉该配置会在 Logstash 的日志中输出一些 <code>WARNING</code></p></blockquote></li><li><p>logstash.conf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>input {
</span></span><span style=display:flex><span>    beats {
</span></span><span style=display:flex><span>      port <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;5044&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output {
</span></span><span style=display:flex><span>    logservice {
</span></span><span style=display:flex><span>      codec <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;json&#34;</span>
</span></span><span style=display:flex><span>      endpoint <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;***&#34;</span>
</span></span><span style=display:flex><span>      project <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;***&#34;</span>
</span></span><span style=display:flex><span>      logstore <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;***&#34;</span>
</span></span><span style=display:flex><span>      topic <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;&#34;</span>
</span></span><span style=display:flex><span>      source <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;&#34;</span>
</span></span><span style=display:flex><span>      access_key_id <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;***&#34;</span>
</span></span><span style=display:flex><span>      access_key_secret <span style=color:#ff79c6>=&gt;</span> <span style=color:#f1fa8c>&#34;***&#34;</span>
</span></span><span style=display:flex><span>      to_json <span style=color:#ff79c6>=&gt;</span> <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>      max_send_retry <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>10</span>
</span></span><span style=display:flex><span>      max_buffer_items <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>4000</span>
</span></span><span style=display:flex><span>      max_buffer_bytes <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>2097152</span>
</span></span><span style=display:flex><span>      max_buffer_seconds <span style=color:#ff79c6>=&gt;</span> <span style=color:#bd93f9>3</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p><code>logstash.conf</code> 为管道配置文件，包含<code>input</code>，<code>filter</code> 和 <code>output</code> 三部分，分别定义了输入，过滤器和输出，这里是简单介绍就不写过滤器</p><p><code>access_key</code> 必须具有 <code>log:PostLogStoreLogs</code> 权限才能写入日志</p></blockquote></li></ul><h3 id=部署>部署<a hidden class=anchor aria-hidden=true href=#部署>#</a></h3><p>为了将 Logstash 部署至 K8s 中，我们还需要编写对应的资源文件：</p><ul><li><p>logstash.yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: ConfigMap
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: logstash
</span></span><span style=display:flex><span><span style=color:#ff79c6>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>logstash.yml</span>: |-<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    http.host: &#34;0.0.0.0&#34;</span>    
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>logstash.conf</span>: |-<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    input {
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      beats {
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        port =&gt; &#34;5044&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      }
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    }
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    output {
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      logservice {
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        codec =&gt; &#34;json&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        endpoint =&gt; &#34;***&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        project =&gt; &#34;***&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        logstore =&gt; &#34;***&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        topic =&gt; &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        source =&gt; &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        access_key_id =&gt; &#34;***&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        access_key_secret =&gt; &#34;***&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        to_json =&gt; true
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        max_send_retry =&gt; 10
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        max_buffer_items =&gt; 4000
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        max_buffer_bytes =&gt; 2097152
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        max_buffer_seconds =&gt; 3
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      }
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    }</span>    
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: apps/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Deployment
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: logstash
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>app</span>: logstash
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>app</span>: logstash
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>app</span>: logstash
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>name</span>: logstash
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>image</span>: logstash-output-logservice:v1.0.0
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>imagePullPolicy</span>: IfNotPresent
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>ports</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ff79c6>containerPort</span>: <span style=color:#bd93f9>5044</span>
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>name</span>: beats
</span></span><span style=display:flex><span>            - <span style=color:#ff79c6>containerPort</span>: <span style=color:#bd93f9>9600</span>
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>name</span>: http
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>volumeMounts</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ff79c6>name</span>: config
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>mountPath</span>: /usr/share/logstash/pipeline/logstash.conf
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>subPath</span>: logstash.conf
</span></span><span style=display:flex><span>            - <span style=color:#ff79c6>name</span>: config
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>mountPath</span>: /usr/share/logstash/config/logstash.yml
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>subPath</span>: logstash.yml
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>resources</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>limits</span>:
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>cpu</span>: 1000m
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>memory</span>: 2Gi
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>requests</span>:
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>cpu</span>: 500m
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>memory</span>: 1Gi
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>volumes</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>name</span>: config
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>configMap</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>name</span>: logstash
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Service
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: logstash
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>app</span>: logstash
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>app</span>: logstash
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: beats
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>port</span>: <span style=color:#bd93f9>5044</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>targetPort</span>: beats
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: http
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>port</span>: <span style=color:#bd93f9>9600</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>targetPort</span>: http
</span></span></code></pre></div></li></ul><p>使用以下指令部署：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl apply -f logstash.yml
</span></span></code></pre></div><p>部署成功后通过 <code>kubectl get po</code> 可以看到正常运行的 Logstash</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get po
</span></span><span style=display:flex><span>NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>logstash-67758cfc7b-n4xm5    1/1     Running   <span style=color:#bd93f9>0</span>          2m
</span></span></code></pre></div><h1 id=测试>测试<a hidden class=anchor aria-hidden=true href=#测试>#</a></h1><p>上面的配置中 <code>input</code> 配置为了 <code>beats</code>，所以我们使用 Filebeat 来进行测试</p><blockquote><p>本文使用的 Filebeat 版本为 <code>8.7.0</code></p></blockquote><h2 id=运行-filebeat>运行 filebeat<a hidden class=anchor aria-hidden=true href=#运行-filebeat>#</a></h2><ul><li>filebeat.yml<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: ConfigMap
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: filebeat
</span></span><span style=display:flex><span><span style=color:#ff79c6>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>filebeat.yml</span>: |-<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    filebeat.inputs:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    - type: log
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      paths:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        - /usr/share/filebeat/logs/test.log 
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    output.logstash:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>      hosts: [&#34;logstash:5044&#34;]</span>    
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#ff79c6>apiVersion</span>: apps/v1
</span></span><span style=display:flex><span><span style=color:#ff79c6>kind</span>: Deployment
</span></span><span style=display:flex><span><span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>name</span>: filebeat
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>app</span>: filebeat
</span></span><span style=display:flex><span><span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>replicas</span>: <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>app</span>: filebeat
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>app</span>: filebeat
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>containers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>name</span>: filebeat
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>image</span>: docker.elastic.co/beats/filebeat:8.7.0
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>volumeMounts</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ff79c6>name</span>: config
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>mountPath</span>: /usr/share/filebeat/filebeat.yml
</span></span><span style=display:flex><span>              <span style=color:#ff79c6>subPath</span>: filebeat.yml
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>volumes</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ff79c6>name</span>: config
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>configMap</span>:
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>name</span>: filebeat
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>items</span>:
</span></span><span style=display:flex><span>              - <span style=color:#ff79c6>key</span>: filebeat.yml
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>path</span>: filebeat.yml
</span></span></code></pre></div>在 ConfigMap 中我们配置了监听容器内 <code>/usr/share/filebeat/logs/test.log</code> 文件的变化，并输出到 <code>logstash:5044</code>（此地址对应上一章节部署 Logstash 时的 Service 定义）</li></ul><p>使用以下指令部署：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl apply -f filebeat.yml
</span></span></code></pre></div><p>部署成功后通过 <code>kubectl get po</code> 可以看到正常运行的 Logstash 和 Filebeat</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ kubectl get po
</span></span><span style=display:flex><span>NAME                         READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>filebeat-b477d46fb-lr44n     1/1     Running   <span style=color:#bd93f9>0</span>          2m
</span></span><span style=display:flex><span>logstash-67758cfc7b-n4xm5    1/1     Running   <span style=color:#bd93f9>0</span>          5m
</span></span></code></pre></div><p>使用以下指令进行测试：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># 进入 Filebeat 容器</span>
</span></span><span style=display:flex><span>$ kubectl <span style=color:#8be9fd;font-style:italic>exec</span> -it filebeat-b477d46fb-lr44n -- bash
</span></span><span style=display:flex><span><span style=color:#6272a4># 使用 echo 指令模拟写日志到 logs/test.log</span>
</span></span><span style=display:flex><span>filebeat@filebeat-b477d46fb-lr44n:~$ <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;this is a test log 3&#34;</span> &gt;&gt; logs/test.log
</span></span><span style=display:flex><span>filebeat@filebeat-b477d46fb-lr44n:~$ <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;this is a test log 4&#34;</span> &gt;&gt; logs/test.log
</span></span><span style=display:flex><span>filebeat@filebeat-b477d46fb-lr44n:~$ <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;this is a test log 5&#34;</span> &gt;&gt; logs/test.log
</span></span></code></pre></div><p>此时在 Logstash 容器的日志中可以看到以下输出：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>[</span>2023-04-24T08:10:58,826<span style=color:#ff79c6>][</span>INFO <span style=color:#ff79c6>][</span>logstash.outputs.logservice<span style=color:#ff79c6>][</span>main<span style=color:#ff79c6>]</span> send logs to logservice success <span style=color:#ff79c6>{</span>:logcount<span style=color:#ff79c6>=</span>&gt;<span style=color:#f1fa8c>&#34;1&#34;</span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>2023-04-24T08:11:11,805<span style=color:#ff79c6>][</span>INFO <span style=color:#ff79c6>][</span>logstash.outputs.logservice<span style=color:#ff79c6>][</span>main<span style=color:#ff79c6>]</span> send logs to logservice success <span style=color:#ff79c6>{</span>:logcount<span style=color:#ff79c6>=</span>&gt;<span style=color:#f1fa8c>&#34;1&#34;</span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[</span>2023-04-24T08:11:12,303<span style=color:#ff79c6>][</span>INFO <span style=color:#ff79c6>][</span>logstash.outputs.logservice<span style=color:#ff79c6>][</span>main<span style=color:#ff79c6>]</span> send logs to logservice success <span style=color:#ff79c6>{</span>:logcount<span style=color:#ff79c6>=</span>&gt;<span style=color:#f1fa8c>&#34;1&#34;</span><span style=color:#ff79c6>}</span>
</span></span></code></pre></div><p>表示我们的日志成功写到了阿里云 SLS 中，登录阿里云控制台进行查看：</p><p><img loading=lazy src=sls-console.png alt></p><h1 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h1><ul><li><a href=https://www.elastic.co/guide/en/logstash/8.7/advanced-pipeline.html>Parsing Logs with Logstash</a></li><li><a href="https://help.aliyun.com/document_detail/49019.html?spm=a2c4g.28984.0.0.323e3e4awhfoI9">安装 Logstash</a></li><li><a href="https://help.aliyun.com/document_detail/28984.html?spm=a2c4g.49019.0.0.3106416fVC5SGL">创建 Logstash 采集配置和处理配置</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.fissssssh.com/tags/elk/>ELK</a></li><li><a href=https://blog.fissssssh.com/tags/k8s/>K8s</a></li></ul></footer><script>(function(){let t=localStorage.getItem("pref-theme");t?t=t==="dark"?"github-dark":"github-light":t=window.matchMedia("(prefers-color-scheme: dark)").matches?"github-dark":"github-light";const e=document.createElement("script");e.src="https://utteranc.es/client.js",e.crossorigin="anonymous",e.async=!0,e.setAttribute("repo","fissssssh/fissssssh.github.io"),e.setAttribute("issue-term","pathname"),e.setAttribute("label","Comment"),e.setAttribute("theme",t),document.body.appendChild(e)})()</script></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.fissssssh.com/>fissssssh</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector(".utterances-frame"),t={type:"set-theme",theme:localStorage.getItem("pref-theme")==="light"?"github-dark":"github-light"};e?.contentWindow.postMessage(t,"https://utteranc.es")})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>